using System;
using easyFramework.Sys;
using easyFramework.Sys.ToolLib;

namespace easyFramework.Sys.Entities
{
	//================================================================================
	//Class:     EntitySearchField

	//--------------------------------------------------------------------------------'
	//Module:    EntitySearchField.vb
	//--------------------------------------------------------------------------------'
	//Copyright: Promain Software-Betreuung GmbH, 2004
	//--------------------------------------------------------------------------------'
	//Purpose:   represents a search-field of a entity
	//--------------------------------------------------------------------------------'
	//Created:   24.08.2004 11:38:07
	//--------------------------------------------------------------------------------'
	//Changed:
	//--------------------------------------------------------------------------------'

	public class EntitySearchField
	{


		//================================================================================
		//Private Fields:
		//================================================================================
		private string msValue; //the string-value as the field is defined
		private bool mbIsSqlSelectStatement; //true, if it is not an entity-field,
		private string msFieldName; //name of the search-field (via table-def)

		//but a subselect e.g.
		//SELECT usr_id, usr_lastname FROM tsUsers ORDER BY 1

		//================================================================================
		//Public Consts:
		//================================================================================

		//================================================================================
		//Public Properties:
		//================================================================================

		//================================================================================
		//Property:  sValue
		//--------------------------------------------------------------------------------'
		//Purpose:   just returns the string-value of the field
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Created:   24.08.2004 11:41:08
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public string sValue
		{
			get
			{
				return msValue;
			}
			set
			{
				mParseStringValue(value);
			}
		}

		//================================================================================
		//Property:  sValue
		//--------------------------------------------------------------------------------'
		//Purpose:   returns the name of the field
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Created:   24.08.2004 11:41:08
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public string sName
		{
			get
			{
				return msFieldName;
			}

		}
		//================================================================================
		//Property:  IsSqlSelectStatement
		//--------------------------------------------------------------------------------'
		//Purpose:
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Created:   24.08.2004 11:41:10
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public bool IsSqlSelectStatement
		{
			get
			{
				return mbIsSqlSelectStatement;
			}
		}
		//================================================================================
		//Public Events:
		//================================================================================

		//================================================================================
		//Public Methods:
		//================================================================================

		//================================================================================
		//Protected Properties:
		//================================================================================

		//================================================================================
		//Protected Methods:
		//================================================================================

		//================================================================================
		//Sub:       mParseStringValue
		//--------------------------------------------------------------------------------'
		//Purpose:   parses the defined string for the search-field and determines wether
		//           it is a sql-statement or not
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Created:   24.08.2004 11:41:13
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		protected void mParseStringValue (string sValue)
		{

			if (Functions.LCase(Functions.Left(sValue, Functions.Len("select "))) == "select ")
			{
	
				mbIsSqlSelectStatement = true;
	
				//----get the field-name------
				string[] asSplitted = Functions.Split(Functions.Trim(sValue), " ");
				if (Functions.LCase(asSplitted[asSplitted.Length -11 - 1]) != "as")
				{
					throw (new efException("Invalid Search-Field definition for entity. Missing \" AS <COLUMNNAME>\" at last: \"" + sValue + "\"."));
				}
	
				msFieldName = asSplitted[asSplitted.Length-1];
	
			}
			else
			{
				mbIsSqlSelectStatement = false;
				msFieldName = sValue;
	
			}

			msValue = sValue;

		}


		//================================================================================
		//Private Consts:
		//================================================================================

		//================================================================================
		//Private Fields:
		//================================================================================

		//================================================================================
		//Private Methods:
		//================================================================================


	}

}
