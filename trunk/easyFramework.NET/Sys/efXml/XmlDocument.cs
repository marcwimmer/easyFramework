using System;
using System.Xml;
using easyFramework.Sys.ToolLib;

namespace easyFramework.Sys.Xml
{
	//================================================================================
	// Project:      easyFramework
	// Copyright:    Promain Software-Betreuung GmbH
	// Component:    XmlDocument.vb
	//--------------------------------------------------------------------------------
	// Purpose:      the basic xml-document
	//--------------------------------------------------------------------------------
	// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
	//--------------------------------------------------------------------------------
	// Changed:
	//================================================================================

	//================================================================================
	//Imports
	//================================================================================

	public class XmlDocument
	{

		//================================================================================
		//private fields:
		//================================================================================
		private System.Xml.XmlDocument moXmlDocument;

		//================================================================================
		//public consts:
		//================================================================================
		public const string efDefaultEncoding = "ISO-8859-1";
		//================================================================================
		//public properties:
		//================================================================================



		//================================================================================
		// Property:     sXml
		//--------------------------------------------------------------------------------
		// Returns:      Xml-Code of the XmlDocument
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public string sXml
		{
			get
			{
				return moXmlDocument.InnerXml;
		
			}
		}


		//================================================================================
		//Property:  oChildren
		//--------------------------------------------------------------------------------'
		//Purpose:   gets the children
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Created:   22.05.2004 18:40:38
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public XmlNodeList oChildren
		{
			get
			{
				XmlNodeList oResult = new XmlNodeList(moXmlDocument.ChildNodes);

				return oResult;
		
			}
	
		}



		//================================================================================
		//Public Methods:
		//================================================================================


		//================================================================================
		// Method:       New
		//--------------------------------------------------------------------------------
		// Purpose:      creates a new xmldocument and adds default-encoding
		//--------------------------------------------------------------------------------
		// Parameters:   sXml
		//--------------------------------------------------------------------------------
		// Returns:      -
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public XmlDocument(string sXml) 
		{
	
			if (Functions.InStr2(Functions.LCase(Functions.Left(sXml, 100)), "encoding=\"") == -1)
			{
				sXml = "<?xml version=\"1.0\" encoding=\"" + efDefaultEncoding + "\" ?>" + sXml;
		
			}
	
			moXmlDocument = new System.Xml.XmlDocument();
			moXmlDocument.LoadXml(sXml);
	
	
		}

		//================================================================================
		// Method:       New
		//--------------------------------------------------------------------------------
		// Parameteres:  creates a new xmldocument, empty
		//--------------------------------------------------------------------------------
		// Returns:      -
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public XmlDocument() 
		{
	
			moXmlDocument = new System.Xml.XmlDocument();
	
	
		}

		//================================================================================
		// Method:       New
		//--------------------------------------------------------------------------------
		// Parameteres:  creates a new xmldocument base on a system.xml.document
		//--------------------------------------------------------------------------------
		// Returns:      -
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public XmlDocument(System.Xml.XmlDocument oXml) 
		{
	
			moXmlDocument = oXml;
	
		}


		//================================================================================
		//Sub:       gLoad
		//--------------------------------------------------------------------------------'
		//Purpose:   loads xml from a file
		//--------------------------------------------------------------------------------'
		//Params:    filename
		//--------------------------------------------------------------------------------'
		//Created:   22.03.2004 23:26:51
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public void gLoad (string sFilename)
		{
	
			moXmlDocument.Load(sFilename);
	
		}

		//================================================================================
		// Method:       selectNodes
		//--------------------------------------------------------------------------------
		// Parameteres:  sXPath - XPath expression
		//--------------------------------------------------------------------------------
		// Returns:      XmlNodeList
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public XmlNodeList selectNodes(string sXPath)
		{
	
			System.Xml.XmlNodeList oXmlNodeList;
			oXmlNodeList = moXmlDocument.SelectNodes(sXPath);
	
			if (oXmlNodeList == null)
			{
				return null;
			}
			return new XmlNodeList(oXmlNodeList);
	
		}

		//================================================================================
		// Method:       selectSingleNode
		//--------------------------------------------------------------------------------
		// Parameteres:  sXPath - XPath expression
		//--------------------------------------------------------------------------------
		// Returns:      XmlNode
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public XmlNode selectSingleNode(string sXPath)
		{
	
			System.Xml.XmlNode oXmlNode;
			oXmlNode = moXmlDocument.SelectSingleNode(sXPath);
	
			if (oXmlNode == null)
			{
				return null;
			}
			return new XmlNode(oXmlNode);
	
	
		}

		//================================================================================
		// Method:       sGetValue
		//--------------------------------------------------------------------------------
		// Parameteres:  makes a //nodename select and returns the value, if a node was
		//               found;
		//--------------------------------------------------------------------------------
		// Returns:      String
		//--------------------------------------------------------------------------------
		// Created:      21.03.04 M.Wimmer (mwimmer@promain-software.de)
		//--------------------------------------------------------------------------------
		// Changed:
		//================================================================================
		public string sGetValue(string sNodeName)
		{
			return sGetValue(sNodeName, "");
		}
		public string sGetValue(string sNodeName, string onNoNodeFound)
		{
	
	
			XmlNode oNode = selectSingleNode("//" + sNodeName);
			if (oNode == null)
			{
				return onNoNodeFound;
			}
			else
			{
				return oNode.sText;
		
			}
	
	
		}



	}

}
