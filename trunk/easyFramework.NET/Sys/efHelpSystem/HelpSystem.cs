using System;
using easyFramework.Sys;
using easyFramework.Sys.ToolLib;

namespace easyFramework.OnlineHelp
{
	//================================================================================
	//Class:     HelpSystem

	//--------------------------------------------------------------------------------'
	//Module:    HelpSystem.vb
	//--------------------------------------------------------------------------------'
	//Copyright: Promain Software-Betreuung GmbH, 2004
	//--------------------------------------------------------------------------------'
	//Purpose:   manages the help-system; is stored in Application-Context;
	//           watches the directory, where the help-files are lieing; updates,
	//           if directory changed
	//--------------------------------------------------------------------------------'
	//Created:   04.06.2004 17:12:25
	//--------------------------------------------------------------------------------'
	//Changed:
	//--------------------------------------------------------------------------------'
	
	public class HelpSystem
	{
		
		//================================================================================
		//Private Fields:
		//================================================================================
		private DirectoryWatch moDirectoryWatcher;
		//================================================================================
		//Public Consts:
		//================================================================================
		
		//================================================================================
		//Public Properties:
		//================================================================================
		
		//================================================================================
		//Property:  sHelpDir
		//--------------------------------------------------------------------------------'
		//Purpose:   returns the directory of the help-files
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Created:   04.06.2004 18:39:21
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public string sHelpDir
		{
			get{
				return moDirectoryWatcher.sDirectory;
			}
		}
		//================================================================================
		//Public Events:
		//================================================================================
		
		//================================================================================
		//Public Methods:
		//================================================================================
		
		//================================================================================
		//Function:  goGetFromClientInfo
		//--------------------------------------------------------------------------------'
		//Purpose:   returns the helpsystem out of the application-context
		//--------------------------------------------------------------------------------'
		//Params:
		//--------------------------------------------------------------------------------'
		//Returns:
		//--------------------------------------------------------------------------------'
		//Created:   04.06.2004 18:28:44
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public static HelpSystem goGetFromClientInfo(ClientInfo oClientInfo)
		{
			
			if (oClientInfo.oHttpApp.oGet("helpsystem") == null == false)
			{
				return ((HelpSystem)(oClientInfo.oHttpApp.oGet("helpsystem")));
			}

			return null;
			
		}
		//================================================================================
		//Sub:       New
		//--------------------------------------------------------------------------------'
		//Purpose:   constructor
		//--------------------------------------------------------------------------------'
		//Params:    sHelpDirectory - the directory, in which the help-files lie
		//--------------------------------------------------------------------------------'
		//Created:   04.06.2004 17:11:27
		//--------------------------------------------------------------------------------'
		//Changed:
		//--------------------------------------------------------------------------------'
		public HelpSystem(string sHelpDirectory) {
			moDirectoryWatcher = new DirectoryWatch(sHelpDirectory);
		}
		
		
		
		//================================================================================
//Sub:       gUpdateDatabase
		//--------------------------------------------------------------------------------'
//Purpose:   store the content of the xml into the database, if the xml-files
		//           were changed
		//--------------------------------------------------------------------------------'
//Params:
		//--------------------------------------------------------------------------------'
//Created:   04.06.2004 18:30:50
		//--------------------------------------------------------------------------------'
//Changed:
		//--------------------------------------------------------------------------------'
		public void gUpdateDatabase (ClientInfo oClientInfo)
		{
			
			bool bExistsAnyHelpEntry = easyFramework.Sys.Data.DataMethodsClientInfo.gbExists(oClientInfo, "tsHelpChapters", "1=1", "*");
			
			
			if (moDirectoryWatcher.gbDifferDirectories(moDirectoryWatcher.sDirectory) | ! bExistsAnyHelpEntry)
			{
				DatabaseUpdate.gUpdate(oClientInfo);
			}
			
		}
		
		//================================================================================
		//Protected Properties:
		//================================================================================
		
		//================================================================================
		//Protected Methods:
		//================================================================================
		
		//================================================================================
		//Private Consts:
		//================================================================================
		
		//================================================================================
		//Private Fields:
		//================================================================================
		
		//================================================================================
		//Private Methods:
		//================================================================================
		
		
	}
	
}
